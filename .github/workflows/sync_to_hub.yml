name: Sync to Hugging Face Hub (Production)
on:
  push:
    # 修改 1: 只有推送到 production 分支時才觸發
    branches: [production]
  workflow_dispatch:

jobs:
  sync-to-hub:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
          lfs: true
          # 修改 2: 明確告訴 checkout action 我們要拉取 production 分支
          ref: production

      - name: Push to hub
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
          HF_USERNAME: "AlchemistAIDev01"
          SPACE_NAME: "Multi_AOP_FastAPI"
        run: |
          git config --global user.email "alchemist.dev01@gmail.com"
          git config --global user.name "AlchemistAIDev01"
          
          # ⚠️ 關鍵修改：直接使用 GitHub Actions 的變量替換語法
          # 這樣在命令執行前，GitHub 會先把 Token 填進去，避免 Shell 讀不到的問題
          git remote add space https://AlchemistAIDev01:${{ secrets.HF_TOKEN }}@huggingface.co/spaces/AlchemistAIDev01/Multi_AOP_FastAPI
          
          # 修改 3: 把當前的分支 (production) 推送到遠端 (space) 的 main 分支
          # 格式: git push <remote> <local_branch>:<remote_branch>
          git push --force space production:main
