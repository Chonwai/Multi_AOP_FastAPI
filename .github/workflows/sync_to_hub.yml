name: Sync to Hugging Face Hub (Production)
on:
  push:
    branches: [production]
  workflow_dispatch:

jobs:
  sync-to-hub:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
          lfs: true
          ref: production

      - name: Push to hub
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          # 1. 設置 Git 提交者身份 (這只是為了記錄 Commit，不影響驗證)
          git config --global user.email "alchemist.dev01@gmail.com"
          git config --global user.name "AlchemistAIDev01"
          
          # 2. 關鍵修正：添加一個叫 space 的遠端，但不帶 Token
          git remote add space https://huggingface.co/spaces/AlchemistAIDev01/Multi_AOP_FastAPI
          
          # 3. ⭐️ 核心修正：直接寫入 HTTP Header 進行驗證
          # 這比把 Token 放在 URL 裡更穩定，且支援 LFS
          # 注意：這裡是 'git config'，不是 URL
          git config --global http.https://huggingface.co/.extraheader "Authorization: Bearer ${{ secrets.HF_TOKEN }}"
          
          # 4. 推送
          git push --force space production:main
