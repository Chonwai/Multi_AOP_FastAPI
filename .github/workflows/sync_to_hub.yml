name: Sync to Hugging Face Hub (Production)
on:
  push:
    branches: [production]
  workflow_dispatch:

jobs:
  sync-to-hub:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
          lfs: true # 雖然我們不推 LFS，但保持開啟避免 checkout 報錯
          ref: production

      - name: Push to hub
        run: |
          git config --global user.email "alchemist.dev01@gmail.com"
          git config --global user.name "AlchemistAIDev01"
          
          # 1. 配置遠端（處理可能已存在的 remote）
          git config --global --unset credential.helper || true
          git remote remove space || true  # 如果 remote 已存在則移除
          git remote add space https://AlchemistAIDev01:${{ secrets.HF_ALCHEMISTAIDEV01 }}@huggingface.co/spaces/AlchemistAIDev01/Multi_AOP_FastAPI
          
          # 2. 推送到 HuggingFace Space
          # 歷史清理（移除大文件）應在本地完成（例如使用 git filter-repo），
          # CI 僅負責同步 production 分支到 Space，避免在 Actions 中重寫歷史。
          git push space production:main
